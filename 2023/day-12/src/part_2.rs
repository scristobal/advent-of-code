/*
 * Advent of code solutions
 * https://www.github.com/scristobal/advent-of-code
 * Licensed under MIT, 2023 Samuel Cristobal
 */

use std::{
    collections::HashMap,
    fmt::{self, Debug, Formatter},
};

use nom::sequence;
use rayon::prelude::*;

#[derive(PartialEq, Clone, Copy, Hash, Eq)]
enum State {
    Unknown, // '?'
    Black,   // '#'
    White,   // '.'
}

use State::*;

#[derive(Hash, PartialEq, Eq, Debug)]
struct Board {
    sequence: Vec<State>,
    lengths: Vec<usize>,
}

impl Debug for State {
    fn fmt(&self, f: &mut Formatter<'_>) -> fmt::Result {
        match self {
            State::Unknown => write!(f, "?"),
            State::Black => write!(f, "#"),
            State::White => write!(f, "."),
        }
    }
}

fn parse(input: &str) -> Board {
    input
        .split_once(' ')
        .map(|(groups, sequence)| Board {
            sequence: groups
                .chars()
                .map(|c| match c {
                    '#' => State::Black,
                    '.' => State::White,
                    '?' => State::Unknown,
                    _ => panic!("Invalid character"),
                })
                .collect(),
            lengths: sequence.split(',').map(|n| n.parse().unwrap()).collect(),
        })
        .unwrap()
}

fn num_possible_arrangements_cached(sequence: &[State], lengths: &[usize]) -> usize {
    let mut cache: HashMap<(&[State], &[usize]), usize> = HashMap::new();
    num_possible_arrangements(sequence, lengths, &mut cache)
}

fn num_possible_arrangements<'b, 'a>(
    sequence: &'a [State],
    lengths: &'b [usize],
    cache: &mut HashMap<(&'a [State], &'b [usize]), usize>,
) -> usize {
    // try cache first
    if let Some(cached_num_arrangements) = cache.get(&(sequence, lengths)) {
        return *cached_num_arrangements;
    };

    // base cases:
    if sequence.is_empty() && lengths.is_empty() {
        // only one arrange possible, the empty one
        cache.insert((sequence, lengths), 1);
        return 1;
    }

    if lengths.is_empty() && sequence.contains(&Black) {
        // no more blacks can be allocated, but the sequence still has at least one black
        cache.insert((sequence, lengths), 0);
        return 0;
    }

    if lengths.is_empty() && !sequence.contains(&Black) {
        // only one arrangement possible: all unknowns are white
        cache.insert((sequence, lengths), 1);
        return 1;
    }

    let min_sequence_len = lengths.iter().sum::<usize>() + lengths.len() - 1;
    if sequence.len() < min_sequence_len {
        // it is impossible to fit the shortest sequence that can accommodate lengths
        cache.insert((sequence, lengths), 0);
        return 0;
    }

    let mut num_arrangements = 0;

    // recursive cases:
    if sequence[0] != Black {
        // try setting the first item of sequence to White
        num_arrangements += num_possible_arrangements(&sequence[1..], lengths, cache);
    }

    let next_group_size = lengths[0];

    if !sequence[..next_group_size].contains(&White) {
        // there is contiguous space for the next group, eg. free of White'
        if next_group_size == sequence.len() {
            // it is the end of the sequence
            num_arrangements += 1;
            cache.insert((sequence, lengths), num_arrangements);
            return num_arrangements;
        }
        // not the end of the sequence, next item should not be black
        if sequence[next_group_size] != Black {
            // try fit a block of size `next_group_size` of `Black`
            num_arrangements +=
                num_possible_arrangements(&sequence[next_group_size + 1..], &lengths[1..], cache);
        }
    }

    cache.insert((sequence, lengths), num_arrangements);
    num_arrangements
}

fn fold(board: &Board, folds: usize) -> Board {
    let sequence = board
        .sequence
        .iter()
        .cloned()
        .chain([Unknown])
        .cycle()
        .take(board.sequence.len() * (folds + 1) + folds)
        .collect();

    let lengths = board
        .lengths
        .iter()
        .cloned()
        .cycle()
        .take(board.lengths.len() * (folds + 1))
        .collect();

    Board { sequence, lengths }
}

pub const FOLDS: usize = 4;

pub fn solve(input: &'static str) -> Result<String, anyhow::Error> {
    let records: Vec<_> = input.lines().map(parse).collect();

    let res: usize = records
        .par_iter()
        .map(|s| fold(s, FOLDS))
        .map(|b| num_possible_arrangements_cached(&b.sequence, &b.lengths))
        .sum();

    Ok(res.to_string())
}

#[cfg(test)]
mod tests {
    use rstest::rstest;

    use super::*;

    #[rstest]
    #[case(parse("???.### 1,1,3"), 1)]
    #[case(parse(".??..??...?##. 1,1,3"), 16384)]
    #[case(parse("?#?#?#?#?#?#?#? 1,3,1,6"), 1)]
    #[case(parse("????.#...#... 4,1,1"), 16)]
    #[case(parse("????.######..#####. 1,6,5"), 2500)]
    #[case(parse("?###???????? 3,2,1"), 506250)]
    fn single_lines_test(#[case] input: Board, #[case] output: usize) {
        let Board { sequence, lengths } = fold(&input, 4);
        assert_eq!(
            num_possible_arrangements_cached(&sequence, &lengths),
            output
        );
    }

    #[test]
    fn solve_sample_test() {
        let result = solve(
            "???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1",
        )
        .unwrap();
        assert_eq!(result, "525152");
    }

    #[rstest]
    #[case(parse("???? 1,1"), 3)]
    #[case(parse("???? 1,2"), 1)]
    #[case(parse("?#?? 2,1"), 1)]
    #[case(parse("??#??? 1,2"), 2)]
    #[case(parse("??#??? 3,1"), 3)]
    #[case(parse("??????##?? 1,4"), 12)]
    #[case(parse(".?????.??#? 1,2"), 11)]
    #[case(parse("??#??? 3,1,1"), 0)]
    #[case(parse("#??????????? 1,6,2"), 3)]
    #[case(parse("#?#??##??? 3,3"), 2)]
    #[case(parse("?????##?? 1,4"), 9)]
    #[case(parse("?#?#?#?#?#?#?#? 1,3,1,6"), 1)]
    #[case(parse("?###???????? 3,2,1"), 10)]
    #[case(parse("????.#...#... 4,1,1"), 1)]
    #[case(parse("????.?..?.. 4,1,1"), 1)]
    #[case(parse("???.### 1,1,3"), 1)]
    #[case(parse(".??..??...?##. 1,1,3"), 4)]
    #[case(parse("?#?#?#?#?#?#?#? 1,3,1,6"), 1)]
    #[case(parse("????.#...#... 4,1,1"), 1)]
    #[case(parse("????.######..#####. 1,6,5"), 4)]
    #[case(parse("?###???????? 3,2,1"), 10)]
    #[case(parse("?#????????????##?? 1,1,10"), 9)]
    #[case(parse("?.???.?#???#???.? 3,6,1"), 5)]
    #[case(parse("#?????#??. 1,3,2"), 1)]
    #[case(parse(".?#????.????.???. 4,4,2"), 4)]
    #[case(parse(".?????.??#? 1,2"), 11)]
    #[case(parse("??##???..??????? 6,1"), 14)]
    #[case(parse("?.?#?#??.?? 1,3"), 2)]
    #[case(parse(".???#?#?..?? 4,1,1"), 2)]
    #[case(parse("???????#?##?#???#.? 2,3,8"), 3)]
    #[case(parse("?.?#?.#??#? 1,4"), 1)]
    #[case(parse("?#?...#??.# 2,1,1"), 2)]
    #[case(parse("???.#????#.? 1,1,1,1"), 12)]
    #[case(parse("?##?????#.#..??.? 3,3,1,1,1"), 7)]
    #[case(parse(".#????????????????? 1,4,3,2,2"), 15)]
    #[case(parse("?????#????. 1,5"), 10)]
    #[case(parse("????????##??????? 2,1,5,2"), 55)]
    #[case(parse("?????#?????????.??? 4,5,2,2"), 8)]
    #[case(parse("?..?..?#?.???? 1,1,3"), 5)]
    #[case(parse("??#???#????#??.?? 1,2,8,1"), 4)]
    #[case(parse("???#????..??? 1,2,1,1"), 27)]
    #[case(parse("?.?.?.?.???.?.??.?? 1,1"), 62)]
    #[case(parse("#??????????? 1,6,2"), 3)]
    #[case(parse("##.????.?????#? 2,4,1,1"), 4)]
    #[case(parse("?.???.?##???#????.? 1,1,10"), 8)]
    #[case(parse("???#???.????????? 1,4,1,7"), 3)]
    #[case(parse("???#??###???? 1,2,6"), 4)]
    #[case(parse("??.????#?????.?. 1,1,3,3,1"), 8)]
    #[case(parse("????#??#??#??##?.?## 12,2,3"), 1)]
    #[case(parse(".????????#????#??? 5,2,5"), 12)]
    #[case(parse("??.???##??.?? 1,2,4,1"), 4)]
    #[case(parse("#.?#?.?????#.??. 1,3,1,1,1"), 11)]
    #[case(parse("??.???????..?#?## 1,3,5"), 16)]
    #[case(parse("?#..#.???????#????#. 2,1,1,9"), 3)]
    #[case(parse("?#?#???.#??. 4,1,1,1"), 3)]
    #[case(parse("????????..?#???#?#.# 1,2,1,1,5,1"), 10)]
    #[case(parse("?#???.????.??###??#? 3,1,1,1,8"), 6)]
    #[case(parse("#?.????##?#. 1,2,3,1"), 1)]
    #[case(parse(".?.????????#????##? 9,2"), 4)]
    #[case(parse("#?..???.#??#????? 2,2,8"), 2)]
    #[case(parse(".?#?#?##?????.?? 11,1"), 4)]
    #[case(parse("?????#??????.#?? 3,2,1,1,3"), 12)]
    #[case(parse("#.????.#?#????.? 1,2,6"), 3)]
    #[case(parse("?#?.???..? 1,2"), 2)]
    #[case(parse("#????###????#????? 1,6,1,1,1"), 24)]
    #[case(parse(".#?#??##??? 3,3"), 2)]
    #[case(parse("??#??#?##??? 2,1,2,1"), 4)]
    #[case(parse(".#???????#??.?#???? 2,1,5,1,2"), 6)]
    #[case(parse("??????.??? 3,2"), 9)]
    #[case(parse("#.#??#?#?????????#?? 1,8,1,1,2,1"), 3)]
    #[case(parse("????#??#???###??#.? 1,10,1"), 4)]
    #[case(parse(".###????#??#???? 3,6"), 3)]
    #[case(parse("?#?#??????.?##?#.?? 8,1,3,1,1"), 2)]
    #[case(parse("??.#?..?#?#?.##?#.? 2,5,4"), 1)]
    #[case(parse(".????????##??#???? 4,3,4"), 10)]
    #[case(parse(".???..?????? 3,1,1"), 10)]
    #[case(parse("?.?...??#?#?# 1,1,3,3"), 1)]
    #[case(parse("??????#????#???#?. 13,2"), 3)]
    #[case(parse("??.??????#?###?# 1,1,1,7"), 13)]
    #[case(parse("??#.????.? 3,3"), 2)]
    #[case(parse("?.?#.?????? 2,2"), 5)]
    #[case(parse("?.#???????????##?? 2,3,7"), 6)]
    #[case(parse("???.#?.???? 1,4"), 1)]
    #[case(parse("#?.???#??#???#?? 1,4,8"), 1)]
    #[case(parse("???##???????#?? 1,6,4"), 7)]
    #[case(parse("?##?##..#??# 2,2,1,1"), 1)]
    #[case(parse("?????#??????.???#?? 7,3,1,3"), 9)]
    #[case(parse("????#???##?????? 1,2,2,1,1"), 30)]
    #[case(parse("??.#?????? 2,1"), 5)]
    #[case(parse("????.???#.?#???# 3,2,2,2"), 4)]
    #[case(parse("#??###???.?? 1,3,1,1"), 4)]
    #[case(parse("???..?#??##??#?? 2,1,8"), 2)]
    #[case(parse(".?.?#???.??## 5,3"), 1)]
    #[case(parse("????..#?.# 1,1,1"), 4)]
    #[case(parse("??????.?#?? 5,1"), 2)]
    #[case(parse("##??.#..???#????. 2,1,1,8"), 1)]
    #[case(parse("?.#?#???#?#?.? 3,5"), 2)]
    #[case(parse("?..##???#?#???#?#??. 3,10"), 2)]
    #[case(parse("?..???#???? 1,2,1"), 13)]
    #[case(parse("????.??.#.?# 1,1,1,1"), 11)]
    #[case(parse("??.??.?.?#?#???????? 1,1,1,5,1,1"), 72)]
    #[case(parse("?#??.??#???..??.#?#? 3,5,1,3"), 8)]
    #[case(parse("?.??????#?????#? 8,3"), 5)]
    #[case(parse("?##???#??#?#.?#.. 11,2"), 1)]
    #[case(parse(".#??????????#??? 3,7"), 4)]
    #[case(parse("##???..???#?..# 3,1,1,3,1"), 1)]
    #[case(parse(".?????#?#??#?. 4,5"), 1)]
    #[case(parse("?#?.?#?#??.?.???#? 2,6,1,1,3"), 2)]
    #[case(parse("???#???.???. 2,3"), 3)]
    #[case(parse("#???????.??.?#??.? 2,2,3"), 10)]
    #[case(parse("????..?##???? 1,5"), 8)]
    #[case(parse("?.???.???? 1,2,1"), 12)]
    #[case(parse("??.#????##????#? 1,7,1,1"), 4)]
    #[case(parse("?????????##???.???? 9,1,3"), 6)]
    #[case(parse("#??#???#????#?#????# 1,1,1,6,1,1"), 4)]
    #[case(parse("???????????#?## 1,2,1,7"), 4)]
    #[case(parse("??#.????.??#.??# 2,1,1,1,3"), 7)]
    #[case(parse("????#.????#??#????# 1,1,1,1,5,1"), 19)]
    #[case(parse(".??...?#????##????## 1,7,4"), 2)]
    #[case(parse("???????.???. 4,1,1"), 13)]
    #[case(parse("?#????????.?? 3,6,1"), 2)]
    #[case(parse("??##?#??..?? 5,1"), 5)]
    #[case(parse("????????####?? 1,9"), 9)]
    #[case(parse("?.??.??##??#????? 1,1,7,1,1"), 8)]
    #[case(parse("???#??.??.??????? 2,1,2"), 58)]
    #[case(parse("??#????#?.? 5,1,1"), 2)]
    #[case(parse("..???.?.??#?. 1,2"), 9)]
    #[case(parse("#????????????#?. 2,6,1"), 4)]
    #[case(parse(".???????#?????#??#. 1,6,3,1"), 16)]
    #[case(parse("??#???.?###??. 5,3"), 2)]
    #[case(parse("?????#.#??????#???. 3,2,4,1,2,1"), 1)]
    #[case(parse("?.??#???.???##?. 4,5"), 6)]
    #[case(parse("?#??????.??.?? 1,4,2,1"), 4)]
    #[case(parse("?????##??. 1,4"), 9)]
    #[case(parse("#??????.????.?.?#?## 3,1,1,1,1,5"), 16)]
    #[case(parse("??????.#??? 1,1,3"), 10)]
    #[case(parse("??????????? 2,4"), 15)]
    #[case(parse("#??#?.???#?..#?#. 5,1,1,1,1"), 2)]
    #[case(parse("##?#???????#???.##? 12,1,3"), 2)]
    #[case(parse("##??#?#???????????.? 11,3"), 4)]
    #[case(parse("??.?#?.?.?.??? 2,2"), 6)]
    #[case(parse("???##???????. 6,1"), 14)]
    #[case(parse("####?.???.???????? 5,4"), 5)]
    #[case(parse("??##???#.?? 5,1,1"), 4)]
    #[case(parse(".#??.????# 1,2,2"), 1)]
    #[case(parse("##?#????.??###? 7,6"), 1)]
    #[case(parse("????#???##.??????? 1,7,3"), 10)]
    #[case(parse("??#?#??#??#???? 4,5"), 3)]
    #[case(parse(".???.?????#?#????.. 1,8,3"), 3)]
    #[case(parse("?????????? 1,1,2"), 35)]
    #[case(parse("???.???#.???#?? 1,1,4,1,1"), 3)]
    #[case(parse("???#?##..##?#???? 7,5"), 1)]
    #[case(parse("???#?#????#?.????#?# 7,4,1,1,1"), 3)]
    #[case(parse("...?????##??##?? 1,10"), 3)]
    #[case(parse("##????.??.? 4,2"), 1)]
    #[case(parse("?#??##?????.?#??? 5,2,3"), 6)]
    #[case(parse("????.?.??.?? 2,2"), 7)]
    #[case(parse("??.??.##??????? 1,2,9"), 2)]
    #[case(parse("#??#?##.?????#?.?# 1,4,7,2"), 1)]
    #[case(parse(".#??#???.??.????# 7,2,5"), 1)]
    #[case(parse(".??????#?#???.#.? 2,5,2,1,1"), 2)]
    #[case(parse("???#?.?#?#?? 3,4"), 4)]
    #[case(parse("?###???????.#????#.# 9,3,2,1"), 2)]
    #[case(parse("??.??????????#?#?? 1,1,1,6,1"), 30)]
    #[case(parse(".??????.?? 1,1,1"), 24)]
    #[case(parse("?????#?.?? 1,2,1"), 15)]
    #[case(parse(".??????#.??#. 2,1,1,1"), 7)]
    #[case(parse("??###???????#.? 6,4"), 3)]
    #[case(parse(".#??.?#??????#????? 3,2,2,5"), 9)]
    #[case(parse(".?.?#.????? 1,1"), 6)]
    #[case(parse("?#.#?????# 1,7"), 1)]
    #[case(parse("?#??#???..??.?.? 8,1"), 4)]
    #[case(parse("###?????????#????. 8,7"), 2)]
    #[case(parse("???#?#????. 5,1"), 6)]
    #[case(parse("??#??##??##???.???? 10,1"), 11)]
    #[case(parse("?#?###????.?.??????? 1,6,4,1"), 3)]
    #[case(parse("??.##????# 1,7"), 2)]
    #[case(parse(".#???#??.##?.??? 1,1,1,3,1"), 6)]
    #[case(parse("..????##?## 2,2,2"), 2)]
    #[case(parse("??#?#?????.???????? 6,4"), 15)]
    #[case(parse("?????#?#?#?#? 2,3,1,2"), 3)]
    #[case(parse("???????#?????? 4,1"), 17)]
    #[case(parse("##??????#??##..? 4,8"), 1)]
    #[case(parse("??.#???..?.#?. 2,1"), 1)]
    #[case(parse("?##???.??????.?# 3,1,3,1,1"), 9)]
    #[case(parse("???##????#??.?#?? 1,2,1,1,3"), 12)]
    #[case(parse("?.???.???????? 1,2,2,1"), 46)]
    #[case(parse("????#??#?#??#?#? 3,8"), 2)]
    #[case(parse("??.???.???#? 1,2,4"), 8)]
    #[case(parse("???##?..?.#?????.#.? 3,3,1"), 2)]
    #[case(parse("?.?.???.??#????? 1,3"), 18)]
    #[case(parse("???#..????? 2,1,3"), 4)]
    #[case(parse("???#??????????? 1,2,1,1,5"), 6)]
    #[case(parse("?#?..?###?? 1,4"), 2)]
    #[case(parse("?#??????#?.??#.??# 1,1,2,2,3"), 7)]
    #[case(parse("?#????????? 1,2,3"), 6)]
    #[case(parse("????.#???..### 1,1,4,3"), 3)]
    #[case(parse("??#.??#??????##?? 1,1,2,7"), 7)]
    #[case(parse("???#?.???# 4,1,1"), 4)]
    #[case(parse(".#??##?#.#?#.. 1,5,3"), 1)]
    #[case(parse("#?#?#??#?????.#?? 3,6,1,1,1"), 2)]
    #[case(parse(".?????#?#.?????. 8,1,3"), 1)]
    #[case(parse("?#????#??? 2,4"), 7)]
    #[case(parse("..???#?.???#? 1,2,1,1"), 6)]
    #[case(parse("???#??##?#? 7,1"), 1)]
    #[case(parse("?##?#??#.?#?##? 2,1,1,1,3"), 1)]
    #[case(parse("#??.?????#?#??# 1,1,1,1,6"), 3)]
    #[case(parse("#?????????????? 1,2,3,2,1"), 15)]
    #[case(parse("??????????#??? 2,1,4"), 52)]
    #[case(parse("??????#??.?????#??.? 7,6"), 9)]
    #[case(parse("????#?#???????????? 3,3,1,1,1,1"), 86)]
    #[case(parse("??#???#??? 3,2"), 5)]
    #[case(parse(".????..#?? 1,1"), 5)]
    #[case(parse("??##?##?.????????. 5,6"), 3)]
    #[case(parse("????..???? 2,1,3"), 2)]
    #[case(parse("???.???.?? 1,1,1"), 28)]
    #[case(parse("??..?..??### 1,1,4"), 2)]
    #[case(parse(".?????.??##.. 1,2"), 6)]
    #[case(parse(".##.?.#????. 2,1,2"), 3)]
    #[case(parse("##??#???##????? 2,7,1"), 7)]
    #[case(parse("#?#???#?##?. 1,1,6"), 2)]
    #[case(parse("???.??##?????? 1,1,4,1"), 21)]
    #[case(parse(".??#.?.??? 3,1,1"), 4)]
    #[case(parse("?????..?.?????#??? 1,1,1,7"), 32)]
    #[case(parse("..???#????#.???? 9,1"), 4)]
    #[case(parse("#?#??..?#????. 1,3,1,1"), 3)]
    #[case(parse("?.??##..?????? 4,1,1"), 10)]
    #[case(parse("..#??#??????#..##? 1,3,1,1,3"), 5)]
    #[case(parse(".?#?.??????????#?? 3,6,1,2"), 4)]
    #[case(parse("..##????#???#?. 3,2,3"), 3)]
    #[case(parse("?#???.?????..??###? 1,1,2,1,5"), 12)]
    #[case(parse("?#?#?????## 3,5"), 1)]
    #[case(parse(".?#?#????? 4,2,1"), 1)]
    #[case(parse("?#?..##?#??? 3,4,1"), 2)]
    #[case(parse("????###????#..# 10,1"), 1)]
    #[case(parse(".#?????#??#.? 2,1,1,1"), 3)]
    #[case(parse("#???#??????? 2,5,1"), 5)]
    #[case(parse(".??????#???#???? 5,3"), 7)]
    #[case(parse(".????#???######?. 2,10"), 2)]
    #[case(parse("????????#???? 2,7"), 10)]
    #[case(parse("???????.#?#??#??? 1,1,7"), 22)]
    #[case(parse("?#??.#?.??? 3,2"), 2)]
    #[case(parse("?#??????#???#??? 4,1,2,1,1"), 9)]
    #[case(parse("??.##?????#? 2,2,1,1"), 3)]
    #[case(parse("????????#????????## 3,2,1,2,3"), 29)]
    #[case(parse("#..????##?? 1,3"), 2)]
    #[case(parse("?#?????##?#?#?#?.?#? 3,5,5,3"), 1)]
    #[case(parse("#?###?.???? 1,4,2"), 3)]
    #[case(parse("??????.?.???.#? 4,1,1,1,1"), 7)]
    #[case(parse("???.??#?#?#???#?? 1,11"), 10)]
    #[case(parse("??.??#??#?##??.? 1,6,2,1,1"), 2)]
    #[case(parse("#????????#.. 1,8"), 1)]
    #[case(parse("?.#???.##?#?.???#?? 1,1,1,2,1,6"), 2)]
    #[case(parse("????#??#??#??.? 7,1,1,1"), 2)]
    #[case(parse("?.????#?#??? 1,6"), 10)]
    #[case(parse("????.???..#?????? 2,7"), 5)]
    #[case(parse("???#?#??#?.. 3,4"), 1)]
    #[case(parse(".??..?.??.?? 1,1,1,1"), 8)]
    #[case(parse("??.#?#?##?#??? 1,6,1,1"), 4)]
    #[case(parse("?.???#?#??#??.#??#. 1,5,1,4"), 3)]
    #[case(parse("..??#?.?#?????? 4,3,1"), 7)]
    #[case(parse(".??#???#.#?#??? 5,4"), 1)]
    #[case(parse("??#.#????##.#.???. 1,1,7,1,1,1"), 1)]
    #[case(parse("?#????.#???#????.?#? 3,6,2,2"), 4)]
    #[case(parse(".???????#?? 1,1,2"), 16)]
    #[case(parse("???#.#????? 4,5"), 1)]
    #[case(parse("??.????#??.??? 1,4,3"), 9)]
    #[case(parse("???..?????##??#????? 1,7,2,1"), 35)]
    #[case(parse("????????????? 2,1,2"), 84)]
    #[case(parse("?#?????.?.??????? 4,2,4"), 6)]
    #[case(parse("???#??#?##????.?..? 10,1,1,1"), 8)]
    #[case(parse("????????#????????. 4,1,2,5"), 9)]
    #[case(parse("??##???.??# 6,1,1"), 2)]
    #[case(parse(".?.?#????????. 4,1"), 9)]
    #[case(parse("#?.??????## 1,2,2"), 4)]
    #[case(parse("?.#?..##???##??? 1,2,2,3"), 2)]
    #[case(parse("????.##??#???#? 1,1,2,2,1"), 6)]
    #[case(parse("????#??..#.? 3,1,1,1"), 3)]
    #[case(parse("??.??#??#? 1,4,2"), 2)]
    #[case(parse("???.??????..?.?? 2,2,1"), 51)]
    #[case(parse("?????????##?.?#.? 1,1,4,1,1"), 25)]
    #[case(parse("#?.?#?..#?#??? 1,2,3,1"), 4)]
    #[case(parse("?.????.????????? 2,6"), 13)]
    #[case(parse("?????#??.. 1,2,1"), 4)]
    #[case(parse("???????#????? 2,7"), 10)]
    #[case(parse("#??#?????.? 7,1"), 2)]
    #[case(parse("???.?.?.?##?????. 1,8"), 5)]
    #[case(parse("#?.????#?.# 1,5,1"), 2)]
    #[case(parse("??#?#??#??? 4,4"), 3)]
    #[case(parse("?#????#?????#? 4,1,3"), 4)]
    #[case(parse(".?..??.?#? 1,1,1"), 2)]
    #[case(parse("???????????#??.?#? 2,1,2,2,2"), 60)]
    #[case(parse("?.????.##?.?##? 1,1,3,2"), 7)]
    #[case(parse("???.?????#??#?#? 2,3,1,5"), 4)]
    #[case(parse(".?##????.?##? 5,1,3"), 2)]
    #[case(parse("#????????? 4,1"), 5)]
    #[case(parse("?????....?#???????. 5,2,6"), 1)]
    #[case(parse(".?#????#?? 3,1,1"), 3)]
    #[case(parse(".#?#.?.#?????#?? 3,1,1,2,1"), 5)]
    #[case(parse("?#?#.??????.??#??#?# 1,1,6,1,2,1"), 1)]
    #[case(parse("?#??...??????#??##?? 4,13"), 1)]
    #[case(parse("?#.???.???#???? 1,2,1,2,1"), 14)]
    #[case(parse("????##??????.# 6,4,1"), 3)]
    #[case(parse("????????????.??? 4,4"), 10)]
    #[case(parse("?.#????????#??.??#? 11,2"), 2)]
    #[case(parse("??.?.#??.#?#? 2,1,1,2"), 1)]
    #[case(parse(".??????????.? 2,3,1"), 25)]
    #[case(parse(".????####?#???????# 11,2"), 5)]
    #[case(parse("??#?.?????? 2,1,1"), 20)]
    #[case(parse("????#?.?.?.#???#.. 1,5"), 1)]
    #[case(parse("?#??.???#??#??.???## 1,1,1,6,4"), 3)]
    #[case(parse("??#???????..?..? 2,3,1,1,1"), 4)]
    #[case(parse("??##?.?????...# 3,1,1,1"), 12)]
    #[case(parse("?.?.?.##????? 1,1,4,1"), 6)]
    #[case(parse("????#????#??? 4,6"), 3)]
    #[case(parse("?????.???? 4,1,1"), 6)]
    #[case(parse("?#??###??#????.????? 13,5"), 2)]
    #[case(parse("?????????#?????? 10,3"), 6)]
    #[case(parse("??.???????..?#?. 4,1"), 4)]
    #[case(parse(".??????..??##.?? 5,4"), 2)]
    #[case(parse("#????.??#?##???????? 1,2,9,1"), 18)]
    #[case(parse("#???##?##?#?#???# 11,2,1"), 1)]
    #[case(parse("???#??##??#????#?? 1,1,7,5"), 2)]
    #[case(parse("?#???????#?#????##. 2,14"), 2)]
    #[case(parse("?#?#???#.?#??.? 7,3,1"), 2)]
    #[case(parse(".?###.?#?.????.#? 4,2,3,2"), 4)]
    #[case(parse("?.#.#??#?#?#?###???? 1,1,1,2,9"), 1)]
    #[case(parse("?###??????#? 3,1,2,1"), 1)]
    #[case(parse("#???#????#????? 1,2,1,2,2"), 9)]
    #[case(parse("???#?????#?#???????? 2,1,1,5,1,4"), 5)]
    #[case(parse("?????????#. 2,2,1"), 10)]
    #[case(parse("?#???#???????#?????? 2,1,1,1,9"), 8)]
    #[case(parse("#?##.?????????##?? 4,1,8"), 9)]
    #[case(parse("?????#???.??#?????. 4,2"), 8)]
    #[case(parse("??????.##.#??## 1,3,2,1,3"), 3)]
    #[case(parse("?????..????.. 3,4"), 3)]
    #[case(parse("?.?##?#???.#????#??? 2,4,1,2,4"), 1)]
    #[case(parse("?.??#????#??#. 4,2,1"), 5)]
    #[case(parse("?.????#?#??#??# 1,2,1,1,5"), 2)]
    #[case(parse("?#.??.?#?#????.?? 1,7,1"), 4)]
    #[case(parse("?#??.?????# 2,2,2"), 4)]
    #[case(parse("#?##??#?#.?.??????#? 9,1,2,1,1"), 3)]
    #[case(parse("??.???#???#.#????? 1,8,2,1"), 6)]
    #[case(parse("?????????##??????? 1,1,9,2"), 15)]
    #[case(parse("???#?.??#?????.## 1,2,8,2"), 3)]
    #[case(parse(".?##????#?#?#?# 3,1,4,1,1"), 1)]
    #[case(parse("?#?##???????#? 6,5"), 4)]
    #[case(parse("??????##?????? 1,1,3,1"), 39)]
    #[case(parse(".??#.??.#?#??#??? 1,1,1,1,4"), 8)]
    #[case(parse("?????#???#.??#? 7,1,2"), 5)]
    #[case(parse("?#???..#??#?##??? 4,9"), 2)]
    #[case(parse(".#.#?.?#?#.?? 1,1,4,1"), 2)]
    #[case(parse("#?###???#? 1,7"), 1)]
    #[case(parse(".##??????##???.??? 4,6,1,1"), 6)]
    #[case(parse("???.???#?#??#?## 2,1,10"), 2)]
    #[case(parse(".??????##??#??#?? 7,1,2"), 4)]
    #[case(parse("???#??#???.??.???? 5,1,2,1,1,1"), 6)]
    #[case(parse(".#?#???????#???#?? 1,7,1,2"), 2)]
    #[case(parse("?.??.?????.??#???? 3,6"), 6)]
    #[case(parse("?.#.?#???..??.??? 1,1,5,2,1"), 3)]
    #[case(parse("###????#????. 8,2"), 2)]
    #[case(parse("?#?#????.?#??.#?? 4,1,3,1"), 10)]
    #[case(parse("..??.???##? 1,5"), 4)]
    #[case(parse("?#?#???..???#?.#??. 2,3,1,2,1,1"), 3)]
    #[case(parse("?#????#???? 7,1"), 5)]
    #[case(parse(".??#.????#? 3,1,1"), 3)]
    #[case(parse(".#...????????? 1,7"), 3)]
    #[case(parse("????.?????#??..? 1,3"), 21)]
    #[case(parse("????????????#??.? 2,1,1,3,1"), 136)]
    #[case(parse("???????#??##?.? 1,1,6"), 16)]
    #[case(parse("??.??#??#.#?.# 1,6,2,1"), 2)]
    #[case(parse("?????..???##? 1,3,4"), 2)]
    #[case(parse("????????.????. 2,2,4"), 10)]
    #[case(parse("?.##?.??#???#??? 1,2,10"), 1)]
    #[case(parse("????#??.?? 2,2,1"), 7)]
    #[case(parse("#.?.?#???.? 1,1,2"), 3)]
    #[case(parse("?.#?..?#?#?#?.? 2,2,1,1,1"), 1)]
    #[case(parse("?#????#???? 1,2,5"), 1)]
    #[case(parse("???????#??#?.?????. 1,6,3,2,1"), 3)]
    #[case(parse("????#????#? 2,1,4"), 4)]
    #[case(parse("???#?.??#???##??? 3,8"), 6)]
    #[case(parse("??#??.?#?##? 2,1,6"), 1)]
    #[case(parse("????#.#.??????#???#? 1,1,1,1,9"), 11)]
    #[case(parse(".?????????.??.? 1,1,3,1,1"), 23)]
    #[case(parse(".?.??..??. 2,1"), 2)]
    #[case(parse("?.????.#??????# 2,1,1,1,1"), 13)]
    #[case(parse("?????#??#..?##?. 6,4"), 1)]
    #[case(parse("?????#?#???.?.#. 2,6,1"), 6)]
    #[case(parse("?#??#?#.?????.?????? 6,1,3,5"), 2)]
    #[case(parse(".?#???????????# 1,9"), 1)]
    #[case(parse("#???#??..???????.? 1,5,4,1,1"), 3)]
    #[case(parse("??.??.?????????#??? 1,1,3,6"), 56)]
    #[case(parse("??.?#?###.? 1,6,1"), 2)]
    #[case(parse("#?????#??#??.????.? 10,1,1,1"), 10)]
    #[case(parse("?????.?#??# 1,4"), 5)]
    #[case(parse("???.????..?##???#? 1,3,8"), 6)]
    #[case(parse(".#.?#???.?.???????? 1,3,1,1,5,1"), 3)]
    #[case(parse("#?.???..#?? 2,1,1"), 4)]
    #[case(parse(".??#.?????#.?. 1,1,6,1"), 1)]
    #[case(parse("????#?..#?##??.??# 2,3,4,3"), 1)]
    #[case(parse("?.?#????###??.?? 1,9,1,1"), 2)]
    #[case(parse("??.?????.?? 1,1,2"), 22)]
    #[case(parse("#..#????#?????????? 1,1,1,9,1"), 4)]
    #[case(parse(".??##????#??#.?? 4,3,1"), 5)]
    #[case(parse("##??#?.??#???.?#??# 2,2,3,5"), 6)]
    #[case(parse("??.??##????#? 1,6,2"), 6)]
    #[case(parse("??#?????..??.?.. 6,1,1"), 9)]
    #[case(parse("???.?.?????##????. 2,1,2,2,1"), 24)]
    #[case(parse("???#????#??#? 4,6"), 5)]
    #[case(parse("????#?????..???#?? 5,3,4"), 9)]
    #[case(parse("?????????.?? 1,7,1"), 2)]
    #[case(parse(".??#?.?????#???? 4,8"), 3)]
    #[case(parse("?.????.#??#?? 4,4"), 1)]
    #[case(parse("##??##.#????..???. 3,2,1,1,3"), 3)]
    #[case(parse(".?.????..????.#? 1,2,1,1,1"), 16)]
    #[case(parse("#?????#???? 1,5,1"), 6)]
    #[case(parse(".?????.#??##????? 3,8"), 3)]
    #[case(parse("#??????#??????????? 3,1,4,3,3"), 5)]
    #[case(parse("??#?##...?#.???#??? 1,4,1,1,2,1"), 4)]
    #[case(parse(".##?..#.???????##?. 3,1,3,5"), 3)]
    #[case(parse("?###???#??????#?.??? 14,2"), 2)]
    #[case(parse("????.?????????#??# 1,1,5,2,1"), 37)]
    #[case(parse("????????.????.? 1,1,1,1,2"), 35)]
    #[case(parse("??.?#???.?#? 1,2,2,3"), 2)]
    #[case(parse("???#?#??????#? 1,6,1"), 4)]
    #[case(parse("???#????.??????.#? 1,1,1,3,1"), 43)]
    #[case(parse("#?##?????? 5,3"), 2)]
    #[case(parse("#..????##???. 1,1,3,1"), 7)]
    #[case(parse(".????#??#????.# 5,1,1,1,1"), 2)]
    #[case(parse("????#?#.??????????? 6,5,3"), 6)]
    #[case(parse(".#??????????? 9,1"), 2)]
    #[case(parse("??????##?? 1,3,2"), 1)]
    #[case(parse("#????#.##?#?#?? 3,1,2,5"), 1)]
    #[case(parse("##??#??#?#.#???? 10,1,1"), 3)]
    #[case(parse("??##?#.?#??.?##?.##? 5,1,1,3,2"), 2)]
    #[case(parse("??.???????..?. 6,1"), 2)]
    #[case(parse("?##?.#????#.? 3,2,1,1"), 4)]
    #[case(parse("#??#.#?????? 4,1,1,2"), 3)]
    #[case(parse("???????.??? 2,1,1"), 40)]
    #[case(parse("#???.#.??#?? 1,1,1,2"), 5)]
    #[case(parse(".??#?###??. 6,1"), 1)]
    #[case(parse(".##?????.?.???#. 4,1,4"), 3)]
    #[case(parse("???.?.??##??? 1,1,2,1"), 16)]
    #[case(parse(".?#.?.???#??.?#?# 1,3,3"), 3)]
    #[case(parse("???????#.?#???? 3,2,2"), 9)]
    #[case(parse("?#????.?#?.? 1,1,3"), 3)]
    #[case(parse("#??#?.??#?.?# 2,1,2,1"), 2)]
    #[case(parse("????????.#????? 2,4"), 7)]
    #[case(parse(".??..??..?. 1,1"), 8)]
    #[case(parse(".?.#.?.#???.? 1,3"), 1)]
    #[case(parse("???##???.?????.? 4,1,1,3"), 3)]
    #[case(parse("?#??##?###??????. 9,1"), 5)]
    #[case(parse(".???.?.??????? 1,1,4"), 28)]
    #[case(parse(".????????#.?.# 6,1,1"), 3)]
    #[case(parse("?#?.???##? 2,5"), 4)]
    #[case(parse("???????#??#?#??????# 5,2,6,3"), 4)]
    #[case(parse(".??.??#??? 1,6"), 2)]
    #[case(parse("??#????????? 1,1,3"), 16)]
    #[case(parse("?#??????#?#????.??#. 13,1,1"), 3)]
    #[case(parse("?????#.?.#??.? 4,2"), 1)]
    #[case(parse("#???.??#.?#? 2,1,2,1"), 1)]
    #[case(parse("#????#?##??????#.??? 1,1,8,1,1,1"), 6)]
    #[case(parse("?#?.????#? 2,1,3"), 6)]
    #[case(parse("???.#????####??#. 1,1,1,1,7"), 2)]
    #[case(parse("??.?#??????##???? 2,2,10"), 3)]
    #[case(parse("?.????#????? 5,1,1"), 4)]
    #[case(parse("??##?????##? 5,3"), 6)]
    #[case(parse("????#?#?#??.??????? 7,2,3,2"), 3)]
    #[case(parse("??#?#.?#.#???? 4,2,3,1"), 1)]
    #[case(parse("?#?????#????? 1,1,1,2"), 11)]
    #[case(parse("?????????.?#???#??. 3,3,8"), 6)]
    #[case(parse("?#????.??#?.?.?.??? 3,3,3"), 4)]
    #[case(parse("???##???#?? 1,2,4"), 4)]
    #[case(parse("?.???.##?##?..?.?.? 1,1,6,1,1,1"), 4)]
    #[case(parse("?#?.?????#? 3,2,2"), 5)]
    #[case(parse("???.???#.? 1,1,1"), 12)]
    #[case(parse("?????.???.#??.#?.?. 1,1,3,2,1,1"), 6)]
    #[case(parse("????.?????#????? 2,9"), 9)]
    #[case(parse("??####??#### 4,5"), 1)]
    #[case(parse(".??.????.. 1,1,1"), 6)]
    #[case(parse("????#????.?... 4,1,1"), 7)]
    #[case(parse("??.?#??#.??..???#?. 3,1,5"), 1)]
    #[case(parse("??##?#?.???.?. 6,1"), 8)]
    #[case(parse("???#??#???#???.?? 4,3"), 3)]
    #[case(parse("?#??#?##????.#??#??? 11,1,5"), 2)]
    #[case(parse("???#?##???#??.?????? 1,1,6,1,4"), 8)]
    #[case(parse("??#?#????.??#????#?? 1,7,1,1,1,1"), 5)]
    #[case(parse("#.??#???.???? 1,4,1,1"), 13)]
    #[case(parse("?.??#???##??????### 1,1,12"), 2)]
    #[case(parse("???#?.?#?..????? 1,1,3,1,2"), 6)]
    #[case(parse("?.?#.????# 1,2,2"), 2)]
    #[case(parse("?????#??#?? 1,1,3"), 8)]
    #[case(parse("#??###.#?? 6,2"), 1)]
    #[case(parse("#????.#???? 1,1,3"), 4)]
    #[case(parse("????#???#.?????..#. 7,1,1,1,1"), 7)]
    #[case(parse("???.??#?????#??.# 1,1,10,1"), 2)]
    #[case(parse("?##????#???.???#??? 9,4"), 8)]
    #[case(parse("?.????#.??.????. 1,2,1,1,2"), 20)]
    #[case(parse("?????.???#??#??? 2,1,1,1,2"), 23)]
    #[case(parse("??##??..?????? 4,4"), 9)]
    #[case(parse("????#???#?..???#. 1,1,6,2,1"), 1)]
    #[case(parse("?.?.???..#???????? 1,1,1,1,2,1"), 88)]
    #[case(parse(".????.????.. 4,2"), 3)]
    #[case(parse(".??.?.#??.?????? 1,2"), 8)]
    #[case(parse(".?.????.#?????#?? 1,1,1,6"), 14)]
    #[case(parse("????#?#??????###??#? 1,1,1,1,11"), 2)]
    #[case(parse("?#??.??#???#??? 2,1,2,3,1"), 6)]
    #[case(parse("?#?..#???..? 2,1,2"), 2)]
    #[case(parse("?.???#?????.? 1,1,4,2"), 1)]
    #[case(parse("#?#??###.. 3,3"), 1)]
    #[case(parse(".???#.??.??? 1,1,1,1"), 16)]
    #[case(parse("??#???.##?.??????. 4,3,4"), 9)]
    #[case(parse("?..?.#?#?#.??? 1,1,3,1"), 7)]
    #[case(parse("?.?...#?.?.?#??? 1,1,2,4"), 2)]
    #[case(parse("???.??.?????#.?#?.. 1,1,6,3"), 7)]
    #[case(parse("##???????.?????##? 3,1,1,3"), 51)]
    #[case(parse("#????#??.??.? 1,4,2,1"), 3)]
    #[case(parse("???????#?#?#.?# 1,3,4,1,1"), 1)]
    #[case(parse("?????.#?#??#?? 3,6"), 3)]
    #[case(parse("?.#??????#..##..??? 1,1,1,4,2,3"), 1)]
    #[case(parse("???????#.???????## 5,1,9"), 2)]
    #[case(parse("#??.??##?. 3,4"), 2)]
    #[case(parse("?..?####????#????#. 1,7,3,1"), 3)]
    #[case(parse("????#?...?#?##??#??? 4,10"), 4)]
    #[case(parse("??.?#??????#??##? 2,3,6"), 8)]
    #[case(parse("#????#??#?##???#??. 1,1,14"), 1)]
    #[case(parse("???##??.?????. 6,2,1"), 6)]
    #[case(parse("#?????????##?#..# 5,6,1,1"), 1)]
    #[case(parse("##???.#???#?#..?#. 5,3,3,1"), 1)]
    #[case(parse("?#????.????#?.?# 1,1,1,2,2"), 18)]
    #[case(parse("????#?.?#? 6,1"), 1)]
    #[case(parse("????#????.?????????? 1,5,1,2,1,1"), 125)]
    #[case(parse(".?#..##???#??? 1,2,3"), 3)]
    #[case(parse("?#????#???#?.?.????# 6,4,1,5"), 1)]
    #[case(parse("??????.#?...?????? 1,2,2,3"), 30)]
    #[case(parse("???##?????.??.?? 8,1,1,1"), 4)]
    #[case(parse("??#????.???? 6,1"), 8)]
    #[case(parse("?.????????#?..??.? 1,1,1,5,1,1"), 8)]
    #[case(parse("?????#?#.???#?.?# 2,1,1,4,1"), 6)]
    #[case(parse(".#?????????..?? 2,1,1,1,1"), 21)]
    #[case(parse(".?.???.???? 1,2"), 15)]
    #[case(parse("??????##????.?????#? 1,5,1,1,1,1"), 56)]
    #[case(parse("?.????#??#?.?.#? 1,2,4,1,1"), 2)]
    #[case(parse("??.?#?#???# 4,1"), 2)]
    #[case(parse("???..#?.??#????. 2,1,6"), 4)]
    #[case(parse("#?###??.?.??? 6,1,3"), 1)]
    #[case(parse("??#??##???. 1,8"), 1)]
    #[case(parse("?#???.??.#??? 4,2,2"), 2)]
    #[case(parse("????????.?? 7,2"), 2)]
    #[case(parse("??.??#?#??#????.#? 1,11,1"), 4)]
    #[case(parse(".??????#?####?# 1,1,1,6"), 6)]
    #[case(parse("?##???#?????? 4,1,2"), 8)]
    #[case(parse("????#?###.. 1,6"), 2)]
    #[case(parse("??.#..??????#???#? 2,1,1,5,3"), 4)]
    #[case(parse("#???#??.#. 1,4,1"), 2)]
    #[case(parse("?#??.#????????##?## 1,14"), 1)]
    #[case(parse(".???###?#??#?. 1,8"), 2)]
    #[case(parse("#????.##?????? 1,2,3,3"), 4)]
    #[case(parse("#?????##??#????##?. 1,2,6,5"), 4)]
    #[case(parse("#?#????#?? 5,1,1"), 1)]
    #[case(parse(".????#??##???. 2,8"), 3)]
    #[case(parse("?#?..????##?? 2,7"), 4)]
    #[case(parse("???###????. 5,1,1"), 1)]
    #[case(parse("????#?#?#?? 4,4"), 1)]
    #[case(parse("?.????.?#??##? 2,2,3"), 9)]
    #[case(parse("??.??????#?????# 2,3,4"), 7)]
    #[case(parse("?..????#??? 1,6"), 4)]
    #[case(parse("?????#???? 4,2"), 4)]
    #[case(parse("#??.?.#??.??.#???. 2,1,3,1,1,1"), 4)]
    #[case(parse("?#.?#?.#..??.?????? 2,1,1,1,1,3"), 6)]
    #[case(parse("#???#?#.??#???# 2,1,1,5,1"), 1)]
    #[case(parse("##?????.#.????.. 2,2,1,1,3"), 2)]
    #[case(parse("?????.??#????.?#?? 3,1,5,2,1"), 6)]
    #[case(parse("????###?????#? 2,5,3"), 6)]
    #[case(parse("#???.##.??..#? 1,2,2,1"), 2)]
    #[case(parse(".#??#???#.?. 5,1"), 1)]
    #[case(parse("???#??#????????.??? 1,2,3,1,2,2"), 30)]
    #[case(parse("?.?#????.??##?.? 3,2"), 2)]
    #[case(parse("????#?????. 5,1,1"), 4)]
    #[case(parse("????????##?.? 3,5"), 5)]
    #[case(parse("??????????????#??##? 3,2,7"), 49)]
    #[case(parse("??.?..?????? 1,1,4"), 9)]
    #[case(parse("#.#???##??#???.????. 1,1,7,1,1,1"), 9)]
    #[case(parse("????#????.?.?? 4,3"), 1)]
    #[case(parse("???.?#??#??#??##?? 1,1,2,2,2,2"), 4)]
    #[case(parse("..???#.??.?? 1,1,1,1"), 8)]
    #[case(parse("?.????#????? 2,2,1"), 11)]
    #[case(parse("##?#??.#?.. 2,1,2"), 1)]
    #[case(parse("??..??#???#?##???? 1,10,1"), 13)]
    #[case(parse("????..????###??? 1,3,5"), 4)]
    #[case(parse("????##?####??.?#?? 2,8,1,2"), 2)]
    #[case(parse(".####???#??.#. 8,1,1"), 1)]
    #[case(parse(".???.????????#.?. 2,3"), 6)]
    #[case(parse(".?.????????. 1,1,1,1"), 25)]
    #[case(parse("?.?#???#??.??? 7,1"), 6)]
    #[case(parse("??.###?##???? 1,7"), 2)]
    #[case(parse("??#??.??#?#??? 2,1,7"), 2)]
    #[case(parse("#?#??##?????#.?.? 3,9"), 1)]
    #[case(parse("#.?????##? 1,1,5"), 3)]
    #[case(parse("??#?.???#?. 2,1,1"), 4)]
    #[case(parse(".#??????.??#????? 4,4"), 3)]
    #[case(parse("?.??????.##???# 1,3,1,3,1"), 3)]
    #[case(parse("?#?.?#.#?#??##??.? 1,1,9"), 1)]
    #[case(parse("?????#.??????#. 1,1,1,1,3"), 13)]
    #[case(parse(".#?#???.?? 1,4"), 1)]
    #[case(parse(".#??#???..???? 6,3"), 2)]
    #[case(parse("??.??.#??#.#???.?? 1,1,4,1,1,1"), 16)]
    #[case(parse("?##?#?#?????.### 9,1,3"), 3)]
    #[case(parse("?#?#?#??#??#?. 8,2"), 2)]
    #[case(parse("?.???..?#??. 1,3"), 8)]
    #[case(parse("##?.?????.#????.#? 3,1,3,1,1,2"), 3)]
    #[case(parse(".??????.?.? 5,1"), 4)]
    #[case(parse("????.#????##?? 1,3"), 2)]
    #[case(parse(".?????????#????. 1,1,5,1"), 31)]
    #[case(parse("????.?##?????.??#??# 3,5,1,1,2,1"), 6)]
    #[case(parse("?.#?#?.???#.? 1,2,1,1"), 3)]
    #[case(parse("?.??#??#??#?.??????. 7,3"), 4)]
    #[case(parse("??????????????#.? 2,2,4"), 21)]
    #[case(parse("?????.??#????#.#? 1,1,1,6,1"), 7)]
    #[case(parse("#??#??#???? 2,1,5"), 2)]
    #[case(parse(".??#???#?? 2,1,1"), 3)]
    #[case(parse("?????.?????????? 1,1,1,6"), 46)]
    #[case(parse("??..???#??.#. 2,4,1,1"), 1)]
    #[case(parse("???#?????? 1,3"), 6)]
    #[case(parse(".??.##??.??#?? 1,2,1,3"), 8)]
    #[case(parse(".????##?#?#?????? 1,6,2"), 13)]
    #[case(parse("????##?##?????? 4,8"), 1)]
    #[case(parse(".??#?#??#?##?????? 1,1,1,11"), 1)]
    #[case(parse("?#?#?#???????# 5,1,1"), 5)]
    #[case(parse("????????#?? 3,1"), 6)]
    #[case(parse(".?????????#. 6,2"), 2)]
    #[case(parse("#??#????#.???##??? 4,1,1,1,5"), 6)]
    #[case(parse("?.????????. 1,1,1"), 41)]
    #[case(parse("?.????#?????#??#? 1,2,1,5"), 31)]
    #[case(parse("?????????..#. 1,1,2,1"), 20)]
    #[case(parse("?????????#?#.???? 1,1,6,1,1"), 22)]
    #[case(parse(".#?##?.??? 5,1"), 3)]
    #[case(parse("?.?.#??????#???#?# 1,1,1,1,7"), 10)]
    #[case(parse("#?.??????#??##? 1,1,9"), 3)]
    #[case(parse("?.??.???.???##?.?? 1,1,1,1,6,2"), 2)]
    #[case(parse("#??#??#..# 2,4,1"), 1)]
    #[case(parse("##???#???????????. 8,1,2,1"), 10)]
    #[case(parse("?#?????.?#???? 4,1"), 2)]
    #[case(parse("#?.?????.#?#???????? 1,5,3,1,3"), 6)]
    #[case(parse("???#?#.?#.???#???? 6,2,1,3,1"), 4)]
    #[case(parse("?.?????.???? 2,1,1,1"), 9)]
    #[case(parse("?#???..??? 4,1"), 6)]
    #[case(parse("#?.??###?????..? 1,8"), 3)]
    #[case(parse("???#?????# 4,1"), 4)]
    #[case(parse("??????????#.??#? 10,1,2"), 1)]
    #[case(parse("?#?#..##.#??.?? 3,2,2,1"), 2)]
    #[case(parse("???????#?##?##?. 2,3,2,3"), 3)]
    #[case(parse("???.?..???? 1,1"), 23)]
    #[case(parse("?.##?##?#.??##??#?? 7,7"), 3)]
    #[case(parse(".??#?????? 5,1"), 6)]
    #[case(parse("..?????.?.#?? 4,2"), 2)]
    #[case(parse("????.????#??? 2,1,2,1"), 26)]
    #[case(parse(".#??#?????????# 1,5,1,2"), 5)]
    #[case(parse("???#??.????????#??? 1,1,1,7,1"), 20)]
    #[case(parse(".??#????.? 6,1"), 2)]
    #[case(parse("???.?..??????? 1,1,3"), 45)]
    #[case(parse("????#??????##.??? 13,2"), 2)]
    #[case(parse("????#?#??? 3,2"), 2)]
    #[case(parse("?.??.???##? 1,3"), 9)]
    #[case(parse("#.?????#????##? 1,1,4,1,3"), 5)]
    #[case(parse("??#??.??.#???#??.?# 1,2,1,6,1"), 2)]
    #[case(parse(".???#?#?.#?? 6,1,1"), 2)]
    #[case(parse("??#??#????????. 9,2"), 6)]
    #[case(parse("?#??#???#?????#??? 1,6,1,1,2,1"), 1)]
    #[case(parse("??#???????##???? 2,10"), 5)]
    #[case(parse("???.????????# 1,1,6"), 7)]
    #[case(parse("???????#??? 1,4"), 18)]
    #[case(parse("?#??#????.? 5,1,1"), 6)]
    #[case(parse("??#?.???#??#???.?#?? 3,8,1"), 6)]
    #[case(parse("??..?#??????##?? 1,5,3"), 8)]
    #[case(parse(".?????#?#????? 3,3,3"), 4)]
    #[case(parse("?????#?????#????##? 6,10"), 5)]
    #[case(parse("?..??.?#?#?..?? 1,1,5,2"), 2)]
    #[case(parse("?#.?#????##??#???? 1,5,8"), 1)]
    #[case(parse("?.??????.??# 1,5,1"), 2)]
    #[case(parse("..?####?###???###? 8,4"), 2)]
    #[case(parse("#??#????#?.#??? 1,8,3"), 1)]
    #[case(parse("?##?..?#?????#?. 2,8"), 2)]
    #[case(parse("???.??#.???##? 3,3,2"), 1)]
    #[case(parse("?.?.??.???????? 1,1,2,5,1"), 3)]
    #[case(parse("??#??#????.??#??#?? 5,2,7"), 6)]
    #[case(parse("???.?#???#.??#??# 1,2,1,5"), 6)]
    #[case(parse("???.?#?.???#???? 3,2,1,3,2"), 2)]
    #[case(parse("?.?????#??#? 1,1,1,1"), 7)]
    #[case(parse("????????#.? 1,2,1"), 16)]
    #[case(parse("??##?????#?.?.? 11,1"), 2)]
    #[case(parse(".?????#?.???# 7,1,1"), 2)]
    #[case(parse("??.??#????#??.???. 1,1,1,3,1,1"), 21)]
    #[case(parse("????##??????..????? 4,2,3"), 27)]
    #[case(parse(".#.?.#???? 1,3"), 1)]
    #[case(parse(".?#??..???. 4,1,1"), 1)]
    #[case(parse("??#????#.?#?#??? 3,2,3,1"), 6)]
    #[case(parse(".???.##????#??????? 2,8,1,1"), 12)]
    #[case(parse("????????.????..??.? 1,2"), 52)]
    #[case(parse("?????#???.?????? 5,1,1,2"), 22)]
    #[case(parse("#?#???##??? 1,8"), 1)]
    #[case(parse("?.????#??#??? 1,10"), 2)]
    #[case(parse("??##????.?.. 8,1"), 1)]
    #[case(parse("###?.????.. 3,4"), 1)]
    #[case(parse("????.????.??????.??? 2,1"), 89)]
    #[case(parse(".??????????#.?? 1,3,2,1"), 24)]
    #[case(parse(".???#?#?#??#???.?. 1,12"), 1)]
    #[case(parse("?.?#?..???? 1,2,3"), 4)]
    #[case(parse("??#..??.????? 1,1,4"), 6)]
    #[case(parse("?#??????.? 3,1,1"), 11)]
    #[case(parse("?#???#???#???##?##?. 1,3,1,7"), 6)]
    #[case(parse(".?.?#..??.???? 1,2,2,4"), 1)]
    #[case(parse("??.??????.#.? 1,3,1,1"), 17)]
    #[case(parse("?#????.???.?# 3,1,2"), 9)]
    #[case(parse("???##???#?##?#??#? 1,15"), 3)]
    #[case(parse(".#?#???.???.????? 6,1,5"), 3)]
    #[case(parse(".?#???????.?.###???? 9,3,1"), 3)]
    #[case(parse("#.?????????###? 1,10"), 2)]
    #[case(parse("..????????###??.?#? 7,4,1"), 1)]
    #[case(parse("?##?#??#??????? 5,2,1,1"), 22)]
    #[case(parse("??#???????#. 1,3"), 1)]
    #[case(parse("????????#?.??.?? 2,1,4,2,2"), 4)]
    #[case(parse("??#??#??#?????#??? 6,1,1,1,1,1"), 4)]
    #[case(parse(".#??????.##? 7,3"), 1)]
    #[case(parse("????##??????#??????. 5,3,2,1,1"), 15)]
    #[case(parse(".???#?#.?###?#.? 2,1,1,5"), 1)]
    #[case(parse("???????.????#. 4,5"), 4)]
    #[case(parse("??#?#.?????#???# 4,2,4,2"), 1)]
    #[case(parse("?..?????##?? 1,9"), 1)]
    #[case(parse("?????.?#??? 3,1,1"), 7)]
    #[case(parse("#?.????????#?? 2,5,2,1"), 2)]
    #[case(parse("?????###.?.? 1,5,1,1"), 2)]
    #[case(parse("????????.#?????.? 1,2,2"), 31)]
    #[case(parse("?????????????????# 1,4,2,2,1"), 70)]
    #[case(parse(".?????.??????.# 2,1,1,2,1"), 22)]
    #[case(parse("?????????##??#####. 1,2,10"), 10)]
    #[case(parse("#?#???##??.??? 3,5,1"), 6)]
    #[case(parse("????????.##????#? 3,1,4,2"), 20)]
    #[case(parse("????#???#????#? 4,2,2"), 10)]
    #[case(parse("?...??.?.??...?? 1,2"), 11)]
    #[case(parse("?#???#.??# 1,1,1"), 1)]
    #[case(parse("??.#?#??#??? 1,1,2,4"), 2)]
    #[case(parse("????.???..#???.????? 1,1"), 14)]
    #[case(parse(".???.?.#?????##???. 2,1,8"), 6)]
    #[case(parse("???????.#?#?.???#? 5,1,4,4"), 2)]
    #[case(parse("?.#.?##..?????.. 1,2,2"), 4)]
    #[case(parse("..??????#.??.??? 6,2"), 3)]
    #[case(parse("??????.?#??.?#??? 1,1,1,2,4"), 16)]
    #[case(parse(".??.???#?..#?##.#??? 1,1,2,4,4"), 6)]
    #[case(parse("???.#???????#???#??? 1,15"), 3)]
    #[case(parse(".#??.??.?#? 1,1,1"), 3)]
    #[case(parse("?????.?.#?#? 1,1,1,1"), 11)]
    #[case(parse("?#???????#??#??? 4,3,5"), 3)]
    #[case(parse("?####?###??? 4,3,1"), 2)]
    #[case(parse(".##?##??##.?.??? 9,1"), 4)]
    #[case(parse("?#?.??#??.. 2,4"), 4)]
    #[case(parse("..????.??. 1,1,1"), 6)]
    #[case(parse("#..??#.???????. 1,1,1,1,1"), 25)]
    #[case(parse("?????.#???##?#?# 1,1,1,8"), 6)]
    #[case(parse("??.?.????#? 2,1,1"), 4)]
    #[case(parse("???#??..?#??????#??? 3,1,2,9"), 1)]
    #[case(parse("??.?????##??.#???#?# 1,1,5,7"), 13)]
    #[case(parse("?????.?##? 3,2"), 3)]
    #[case(parse("?#?.?##.????????#.?# 3,2,1,3,1,1"), 6)]
    #[case(parse("?######?????#??#. 8,1,1"), 2)]
    #[case(parse("?.??#??????#??? 7,2,1"), 4)]
    #[case(parse("???????.?#?#.???.? 2,1,1,4,1,1"), 16)]
    #[case(parse("??.#?##??.?.??#? 1,6,1,3"), 4)]
    #[case(parse("???#???.???. 5,1"), 10)]
    #[case(parse("??????.??. 4,2"), 3)]
    #[case(parse("???#??#?????##???. 14,2"), 1)]
    #[case(parse(".???#?.??.?# 2,1,1,1"), 2)]
    #[case(parse("??????.??#??.???? 6,4,3"), 4)]
    #[case(parse("?#??#?????#??##????. 15,1"), 5)]
    #[case(parse("#?#??????##????.?? 7,4,1,1"), 6)]
    #[case(parse(".??#???#?????.#? 1,1,5,1,2"), 3)]
    #[case(parse("?.#?.??###?#??##??? 1,1,14"), 1)]
    #[case(parse("?????????##?#?????# 3,1,3,1,2,1"), 12)]
    #[case(parse("?#?##.?.?? 5,2"), 1)]
    #[case(parse(".?????.?.#?#??#? 2,1,1,1,5"), 3)]
    #[case(parse("#??#????.????? 1,1,2,1"), 13)]
    #[case(parse("??????#?##?#??.? 1,1,8,1"), 11)]
    #[case(parse("?###?#..?.#??? 5,2"), 1)]
    #[case(parse("##????.??#??##??# 2,1,1,1,5"), 4)]
    #[case(parse(".#??##??.?#??.?#???? 1,4,2,1,4"), 4)]
    #[case(parse("#??#???.?.?#??#.#? 4,2,1,5,1"), 1)]
    #[case(parse(".????..??.#????.? 1,5"), 6)]
    #[case(parse(".?.?????#? 1,1,2"), 11)]
    #[case(parse("#??#.?#??????? 1,2,8"), 2)]
    #[case(parse("#???#####?#??? 1,11"), 2)]
    #[case(parse("?.#??????? 3,1"), 4)]
    #[case(parse("??.?##???#??.??#?.? 1,3,2,1,1,1"), 16)]
    #[case(parse("?.?.??##?.?#?#???? 1,4,8"), 4)]
    #[case(parse("???#?#??.##????#?? 3,1,1,4,3"), 2)]
    #[case(parse("??##???#.. 5,1"), 2)]
    #[case(parse("?.#???#??.?? 2,4"), 1)]
    #[case(parse(".???.#..?#???.?? 2,1,4,1"), 8)]
    #[case(parse(".?.???#?????? 1,1,5,1"), 4)]
    #[case(parse("???##?###???#??# 9,5"), 2)]
    #[case(parse("??#?..?.#??? 2,1,1,1"), 4)]
    #[case(parse("?##???????? 2,3"), 5)]
    #[case(parse("?#?.?#?#.#?.?.? 1,4,2,1"), 2)]
    #[case(parse("??????????.??? 2,4,3"), 10)]
    #[case(parse("?#????#??#.?#.?..? 7,1,2,1,1"), 2)]
    #[case(parse("?#?.?#.???.??#??.?. 2,1,1,3,1,1"), 6)]
    #[case(parse("???.##??#?????..# 3,9,1"), 1)]
    #[case(parse("?#?#????????? 5,2,3"), 4)]
    #[case(parse(".??##????.?#???#?? 5,1,3,2"), 9)]
    #[case(parse("???.#.?#..#???? 3,1,1,2,1"), 2)]
    #[case(parse("????????##?. 2,5"), 7)]
    #[case(parse("?#.?#??##?. 1,6"), 2)]
    #[case(parse("???.#???#?#?#?? 2,5,5"), 2)]
    #[case(parse("..#..#??????#?#? 1,6,3"), 1)]
    #[case(parse("??#?#??????.#??#? 5,1,4"), 12)]
    #[case(parse("?#??.?????.??????# 2,1,4,7"), 2)]
    #[case(parse(".???.?????????#????? 3,2,1,2,2,1"), 26)]
    #[case(parse("??.????.?#.?? 1,1,1,1"), 28)]
    #[case(parse("????.????#?. 3,4"), 4)]
    #[case(parse("?????#..?????#?????# 1,1,6,1,1,1"), 4)]
    #[case(parse("..??????.?? 1,3"), 3)]
    #[case(parse("?#.#?.?#?##???##???? 2,1,6,3,3"), 1)]
    #[case(parse("?##???..?.?.??.#??#? 6,1,2,1,1"), 2)]
    #[case(parse("????#.#?##????#?? 1,1,1,6,1"), 1)]
    #[case(parse(".????.??##??#??.???# 1,1,9,1,1"), 6)]
    #[case(parse("???#??#??.????#.??? 5,1,1,2,2,1"), 3)]
    #[case(parse("????##??#??###?#.??? 6,1,6,1"), 6)]
    #[case(parse(".????????? 3,2"), 10)]
    #[case(parse("#??#.??#???#?#?# 4,1,1,6"), 1)]
    #[case(parse("..#?...??#?##? 2,6"), 2)]
    #[case(parse("?.#??#??#???##??# 9,5"), 1)]
    #[case(parse("..#.????????? 1,3"), 7)]
    #[case(parse("???.????????.? 2,5,2,1"), 2)]
    #[case(parse("?#.??.??????? 1,1,7"), 2)]
    #[case(parse("?#???#?#?.. 1,5"), 2)]
    #[case(parse(".??#?.??.?.???.#?.? 3,2,1,1,2,1"), 8)]
    #[case(parse("?????.???????#?##. 1,2,1,1,2,4"), 3)]
    #[case(parse("???#??#??#?. 6,2"), 3)]
    #[case(parse("?####.??.#?? 5,1,1"), 3)]
    #[case(parse(".??#?#????# 1,8"), 1)]
    #[case(parse("???.##???..??#???? 4,2"), 2)]
    #[case(parse("???#???????#?. 1,1,6"), 5)]
    #[case(parse("????.??????? 1,4"), 19)]
    #[case(parse("???....#???. 1,3"), 3)]
    #[case(parse(".?.?????##?.??.?. 1,1,4,1,1"), 12)]
    #[case(parse("##????.??.#??????? 3,1,1,2,1,3"), 4)]
    #[case(parse("??#???#?.#.?????#?. 1,6,1,6"), 2)]
    #[case(parse("????##?##?.??????? 1,3,2,4,1"), 6)]
    #[case(parse("??.???#??.?????.? 1,4,3,1"), 28)]
    #[case(parse("???.?#.???? 1,1,2"), 11)]
    #[case(parse("?#?###?#????????.?? 16,1"), 2)]
    #[case(parse("??#.???.???.??? 1,2,1,1,1"), 12)]
    #[case(parse(".??..#?#?# 1,5"), 2)]
    #[case(parse("????.???????#? 4,8"), 2)]
    #[case(parse("???###???##?????#?? 1,10,3"), 9)]
    #[case(parse("???#??.??#.?. 3,3"), 3)]
    #[case(parse("????###?#?#?..??? 5,3,2"), 2)]
    #[case(parse("?????##?#?#????#??## 3,7,1,1,2"), 4)]
    #[case(parse("?..#?#?.?#.? 1,3,2,1"), 1)]
    #[case(parse("????#..????.. 2,3"), 2)]
    #[case(parse("??#.???#?#??#????.? 3,3,8"), 1)]
    #[case(parse("???#?.??????? 1,2,1,1"), 49)]
    #[case(parse("?????#?????#??##?? 1,1,2,1,8"), 6)]
    #[case(parse("#?????.??.?????.? 1,1,1,4,1"), 22)]
    #[case(parse("????.??????.? 1,3,1"), 31)]
    #[case(parse("????????????#? 7,2"), 9)]
    #[case(parse("????..??#?? 1,4"), 8)]
    #[case(parse("?#???????#?#???#.? 4,3,2"), 2)]
    #[case(parse("?.#??..???? 1,1"), 6)]
    #[case(parse(".??###????.??? 7,1"), 10)]
    #[case(parse("?#???????#???#?? 1,2,3,1,1"), 11)]
    #[case(parse("..???????????????#? 2,2,6,1"), 10)]
    #[case(parse(".##?????????..??#?? 9,5"), 1)]
    #[case(parse("???????..?? 1,1"), 29)]
    #[case(parse("????#?????.?#?#? 1,6,1,4"), 2)]
    #[case(parse("??.?#?..???? 1,1,1,1"), 6)]
    #[case(parse("?????#????#???####?? 1,2,9"), 15)]
    #[case(parse("#??#???#?#??.????? 1,9,2,1"), 6)]
    #[case(parse(".???.????????. 1,4,1"), 19)]
    #[case(parse("??.??#??.##?.???? 1,3,1,2,1"), 8)]
    #[case(parse(".?##??.?????#? 4,2,1"), 6)]
    #[case(parse("..???#????????#?. 1,3,1,3"), 18)]
    #[case(parse("#???#?#?.?#?#.#??# 8,3,1,1"), 1)]
    #[case(parse("?#?????.???? 3,1,2,1"), 5)]
    #[case(parse("#..?.?.#???? 1,1,1,1"), 8)]
    #[case(parse("#?#.#?#??#.?. 3,1,4,1"), 1)]
    #[case(parse("?#???.???#?? 4,1,1,1"), 4)]
    #[case(parse(".?#?#?#..?##?????? 1,1,1,3,1,1"), 9)]
    #[case(parse("?###?#??????? 3,3,2"), 3)]
    #[case(parse("#???#???.?.??# 1,4,1,3"), 4)]
    #[case(parse("????#?#?#?..??.?#? 6,2"), 4)]
    #[case(parse(".????#?#?#?.??? 9,1"), 6)]
    #[case(parse(".#?#??#?#????### 8,4"), 1)]
    #[case(parse("????.?##?#?? 3,6"), 4)]
    #[case(parse("???#?###?#?##????.? 4,8,1"), 4)]
    #[case(parse("????#?????##???.???. 1,4,7,2"), 8)]
    #[case(parse("??.?#????#?.??#?##? 1,2,3,1,1,3"), 8)]
    #[case(parse("??????????#?#?? 3,6,2"), 2)]
    #[case(parse("????#?????.????????# 9,1,1,1,1,1"), 2)]
    #[case(parse("?#???#????.##???? 1,4,2,2,1"), 3)]
    #[case(parse(".????#?..##?#??.? 1,4,5,1"), 1)]
    #[case(parse("??####??#??.?#.???? 5,3,2,1,1"), 9)]
    #[case(parse("??.???#?.?? 2,2,2"), 4)]
    #[case(parse("??????##???? 3,3"), 6)]
    #[case(parse(".?#?.?#?#??# 1,7"), 1)]
    #[case(parse("?##?#?##???#?????? 5,11"), 1)]
    #[case(parse("?#?.???.??.?????.?#. 2,1,1,5,2"), 14)]
    #[case(parse(".???.???..#.. 2,1,1,1"), 2)]
    #[case(parse("????##?##?.#?#???? 2,5,1,3,1"), 2)]
    #[case(parse("??..#?##?#?? 2,6,1"), 1)]
    #[case(parse("???#???.#??? 1,1,1,4"), 4)]
    #[case(parse("?.?#?????##????#.? 3,1,3,3"), 4)]
    #[case(parse("??#?.????#??#???#?#. 3,1,11"), 4)]
    #[case(parse("?????.??#? 2,2,3"), 2)]
    #[case(parse("???#?#?..?????. 4,4"), 4)]
    #[case(parse("???.??.?.#??.? 2,2"), 3)]
    #[case(parse("??.#???.??????? 4,2"), 6)]
    #[case(parse("?.???#?#?#?#??.?..? 1,12,1,1"), 1)]
    #[case(parse("?#.??????#.##????# 1,6,2,1,1"), 2)]
    #[case(parse("??#????.#???????.. 1,2,1,3,1,1"), 6)]
    #[case(parse(".#?.#??#???????.??? 1,2,2,3,1,1"), 6)]
    #[case(parse("????.#???????#??.??? 1,1,1,4,1,2"), 34)]
    #[case(parse("????.?????? 2,1"), 25)]
    #[case(parse("#???#????.?. 5,1"), 4)]
    #[case(parse("???#?????.?.??##??? 1,6,5"), 9)]
    #[case(parse("??.??#??????#?????.# 1,6,2,1,1,1"), 19)]
    #[case(parse("#???###????.?? 7,1,1,1"), 2)]
    #[case(parse(".????.?#..? 4,1"), 1)]
    #[case(parse(".?.????#??????# 8,1"), 3)]
    #[case(parse("?.#????#?##??? 1,10"), 2)]
    #[case(parse("?.??#?.???? 3,2"), 6)]
    #[case(parse(".##..#?#.??..???.? 2,3,1,1"), 12)]
    #[case(parse("?????..#?? 4,1,1"), 2)]
    #[case(parse("?????????????#. 1,1,9"), 3)]
    #[case(parse("#?##??.??#.?? 6,1,1,1"), 2)]
    #[case(parse("...???.??#. 1,1,1"), 4)]
    #[case(parse("??#?#?.?.?.#?? 6,2"), 1)]
    #[case(parse(".???.????????? 1,1,1,3"), 46)]
    #[case(parse("???##?.??#???# 3,1,5"), 2)]
    #[case(parse("##???#????????. 2,10"), 2)]
    #[case(parse("#????????.#?..??#.?? 3,5,2,3"), 1)]
    #[case(parse(".###??.?????. 4,1,1"), 6)]
    #[case(parse("..????###?#??#???? 2,9"), 3)]
    #[case(parse("????#???#..#?.??#? 3,3,2,1,1"), 1)]
    #[case(parse(".????#..?##?????? 5,4,1,1"), 4)]
    #[case(parse("??#?????????.?# 7,1,1,2"), 4)]
    #[case(parse("#?#?#??????##??# 7,6"), 1)]
    #[case(parse("#??.????##. 3,4"), 1)]
    #[case(parse("###?##.?##???.?????? 6,4,2"), 10)]
    #[case(parse("#?????#?.??# 1,3,1,3"), 1)]
    #[case(parse("#?#?##??#????#???.? 1,9,1,1,1"), 2)]
    #[case(parse("##???#?##?.???#. 2,6,1,1"), 4)]
    #[case(parse("?????#?#?.?# 1,4,2"), 7)]
    #[case(parse(".?????????? 1,6,1"), 1)]
    #[case(parse("?#?????????#? 1,6"), 2)]
    #[case(parse(".???????#??#.?.?? 3,1,1,2,1"), 9)]
    #[case(parse("?.#.??????# 1,3,1"), 3)]
    #[case(parse("###???.????????.???? 5,2,1,1,1,1"), 34)]
    #[case(parse(".##.?.?#????.?.? 2,6,1"), 2)]
    #[case(parse("?????##???##.???#? 1,6,2,4"), 6)]
    #[case(parse("?#??#?.??#? 3,1,3"), 2)]
    #[case(parse(".????.#.?.# 2,1,1"), 3)]
    #[case(parse("??????#?##????.? 1,9"), 10)]
    #[case(parse("????..??#??##??? 2,10"), 3)]
    #[case(parse("###?????.???? 7,1,1"), 3)]
    #[case(parse("###?#??????#.? 5,5"), 1)]
    #[case(parse("?.##??##?. 3,2"), 1)]
    #[case(parse("?.#.?.?#????#?.?? 1,3,3"), 3)]
    #[case(parse("#???#??#.?? 3,1,1"), 1)]
    #[case(parse("..??.???????.?. 1,4,1"), 17)]
    #[case(parse("??##?#????.?????. 8,2"), 12)]
    #[case(parse("??#??????.. 3,2"), 9)]
    #[case(parse("????##??#??...??. 8,1,2"), 1)]
    #[case(parse("#.?????###????? 1,1,1,3,1"), 12)]
    #[case(parse("#.????#.#.???????##? 1,1,3,1,1,7"), 3)]
    #[case(parse("##?#???#??..??? 4,4,1"), 6)]
    #[case(parse(".????#?#???#????? 5,6"), 7)]
    #[case(parse("#??#?????.?? 1,2,2,1"), 11)]
    #[case(parse("???##???.?..? 4,1"), 9)]
    #[case(parse(".#????????#??.? 1,1,3,1,1"), 10)]
    #[case(parse("????.???????.##??? 1,2,3,5"), 17)]
    #[case(parse("???..?##??????? 2,8"), 4)]
    #[case(parse("?#?#?##?.?.???#. 8,1,1,1"), 2)]
    #[case(parse("?????.#?#??#??????? 1,1,12"), 6)]
    #[case(parse("????.#???#??#? 3,3,1,2"), 4)]
    #[case(parse("?.?#?.#?#????#..? 1,2,6,1,1"), 2)]
    #[case(parse("###?.??#.#????? 4,1,1,2,1"), 4)]
    #[case(parse("?.???##??####??#?? 4,8"), 3)]
    #[case(parse("???#####?# 7,1"), 1)]
    #[case(parse("?##??#?..?#???? 6,1,3"), 2)]
    #[case(parse("???????#??.?#????##? 1,2,3,3,2"), 20)]
    #[case(parse("??????#?????##?# 1,6,4"), 10)]
    #[case(parse(".?.?#..????? 1,1,3"), 4)]
    #[case(parse(".?#?????##?? 2,8"), 1)]
    #[case(parse("????#.?.????##?? 1,1,1,1,5"), 15)]
    #[case(parse("?????.#??.. 1,2"), 5)]
    #[case(parse("##??..???###??#.? 4,5,1"), 2)]
    #[case(parse("???.?#??#?.#?? 3,1,2,3"), 2)]
    #[case(parse(".??#?#??#??? 2,7"), 1)]
    #[case(parse("?#???.??#?.??? 5,1,1,1"), 4)]
    #[case(parse("...????##?.???????. 2,4,3"), 5)]
    #[case(parse("??????????.??? 1,1,3,1"), 65)]
    #[case(parse(".???#??#??? 7,2"), 1)]
    #[case(parse(".#?#?...?.. 4,1"), 1)]
    #[case(parse("??.??..?#????? 1,4"), 9)]
    #[case(parse("?###?###??#?????? 8,2,2,1"), 5)]
    #[case(parse("??.?????#??.?#. 1,1,4,2"), 13)]
    #[case(parse("?#?.???#??..?? 2,5,1"), 8)]
    #[case(parse("????.????.???# 4,1,2,3"), 1)]
    #[case(parse("???.#..?.# 1,1,1"), 4)]
    #[case(parse("?#..#?#?#????.??? 1,8,3"), 1)]
    #[case(parse(".???...#???#????#??? 1,5,5"), 10)]
    #[case(parse("???##?##???#??.? 1,10,1"), 4)]
    #[case(parse("#??????#????? 1,6"), 6)]
    #[case(parse(".??????###??????# 12,1"), 3)]
    #[case(parse("??????..?? 1,1,1"), 24)]
    #[case(parse("????..#?.??????????? 1,1,1,5,4"), 9)]
    #[case(parse("?#?????#??.?.. 9,1"), 2)]
    #[case(parse("???##???..?. 5,1"), 7)]
    #[case(parse("#.?#?.#.????.???# 1,3,1,2,4"), 3)]
    #[case(parse(".??#?.?#??#??. 1,2,2"), 3)]
    #[case(parse("?#????#?.??#?????? 3,1,1,1,1,1"), 25)]
    fn single_line_fold0_test(#[case] input: Board, #[case] output: usize) {
        let Board { sequence, lengths } = fold(&input, 0);
        assert_eq!(
            num_possible_arrangements_cached(&sequence, &lengths),
            output
        );
    }
}
